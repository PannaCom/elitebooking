@{
    ViewBag.Title = "Confirm";
    Layout = "~/Views/Shared/_LayoutHotelDetailNoIndex.cshtml";
}
<!-- Parallax Effect -->
<script type="text/javascript">$(document).ready(function(){$('#parallax-pagetitle').parallax("50%", -0.55);});</script>
<section class="parallax-effect">
  <div id="parallax-pagetitle" style="background-image: url(./images/parallax/1900x911.gif);">
    <div class="color-overlay"> 
      <!-- Page title -->
      <div class="container">
        <div class="row">
          <div class="col-sm-12">            
            <h2 style="margin-top:5px;">Xác nhận đặt phòng khách sạn @ViewBag.hotelname</h2>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<div class="container">
  <div class="row"> 
    <!-- Contact form -->
    <section id="contact-form" class="mt50" style="margin-top:9px;">
      <div class="col-md-6" >
        <h2 class="lined-heading" style="margin-bottom:2px;"><span>Điền thông tin khách hàng</span></h2>
        <p style="margin-top:2px;">Xin lưu ý, việc thu tiền chỉ được tiến hành sau khi quý khách nhận được xác nhận còn phòng từ EliteHotel. 
			EliteHotel sẽ chủ động liên hệ với quý khách (qua email hoặc điện thoại) trong vòng 8 tiếng giờ hành chính kể từ khi nhận được yêu cầu đặt phòng của quý khách 	(từ lúc form này được gởi đi) để xác nhận tình trạng phòng và thời hạn thanh toán. 
		</p>
        <div id="message"></div>
        <!-- Error message display -->
        <form class="clearfix mt50" role="form" method="post" name="contactform" id="contactform" style="margin-top:2px;">
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="name" accesskey="U" style="display:block;width:auto;"><span class="required">*</span> Họ Tên</label>
                <input name="cname" type="text" id="cname" class="form-control" value=""/>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="email" accesskey="E"><span class="required">*</span> E-mail</label>
                <input name="cemail" type="text" id="cemail" value="" class="form-control"/>
              </div>
            </div>
			<div class="col-md-6">
              <div class="form-group">
                <label for="email" accesskey="E"><span class="required">*</span> Di động</label>
                <input name="cphone" type="text" id="cphone" value="" class="form-control"/>
              </div>
            </div>
			<div class="col-md-6">
              <div class="form-group">
                <label for="email" accesskey="E"><span class="required">*</span> Địa chỉ</label>
                <input name="caddress" type="text" id="caddress" value="" class="form-control"/>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label for="email" accesskey="E" class="wauto">Chọn hình thức thanh toán</label>
				<select class="form-control" name="paymenttype" id="paymenttype">                  
                  <option value="@HotelGolfBooking.Config.payment_method1">@HotelGolfBooking.Config.payment_method1</option>
                  <option value="@HotelGolfBooking.Config.payment_method2" selected>@HotelGolfBooking.Config.payment_method2</option>
                  <option value="@HotelGolfBooking.Config.payment_method3">@HotelGolfBooking.Config.payment_method3</option>
				  <option value="@HotelGolfBooking.Config.payment_method4">@HotelGolfBooking.Config.payment_method4</option>
                </select>
          </div> 
          <div class="form-group">
            <label for="comments" accesskey="C"> Ghi chú</label>
            <textarea name="cnote" rows="9" id="cnote" class="form-control"></textarea>
          </div>          
          <button type="button" class="btn btn-info" onclick="confirm();" id="btnconfirm">Xác nhận</button>
        </form>
      </div>
    </section>
    
    <!-- Contact details -->
    <section class="contact-details mt50" style="margin-top:9px;">
      <div class="col-md-6">
        <h2 class="lined-heading" style="margin-bottom:2px;"><span>Quy định đặt và hủy phòng</span></h2> 
        <div id="divCompanyBanking">
            <script>
                getCompanyBanking();
            </script>
        </div>       
        <p>@Html.Raw(@ViewBag.rule)</p>
      </div>
    </section>
  </div>
</div>
<!--Script references. -->
    <!--Reference the jQuery library. -->
    <script src="/Scripts/jquery-1.8.2.min.js" ></script>
    <!--Reference the SignalR library. -->
    <script src="/Scripts/jquery.signalR-2.2.0.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="/signalr/hubs"></script>
    <!--Add script to update the page and send messages.--> 
    <script type="text/javascript">
        var chat;
        $(function () {
            // Declare a proxy to reference the hub. 
            chat = $.connection.chatHub;
            // Start the connection.
            $.connection.hub.start().done(function () {
                //$('#sendmessage').click(function () {
                // Call the Send method on the hub. 
                chat.server.joinRoom("alertadmin", 'joined');
                //});
            });
        });
</script>
<script>
    function confirm() {
        //check field
        
        if($("#cname").val()==""){
            alert("Nhập họ tên khách hàng");
            $("#cname").focus();
            return;
        }
        if($("#cemail").val()==""){
            alert("Nhập email");
            $("#cemail").focus();
            return;
        }
        if($("#cphone").val()==""){
            alert("Nhập số điện thoại");
            $("#cphone").focus();
            return;
        }
        if($("#caddress").val()==""){
            alert("Nhập địa chỉ");
            $("#caddress").focus();
            return;
        }
        document.getElementById("btnconfirm").disabled=true;
        var formdata = new FormData(); //FormData object
        formdata.append("idhotel", @ViewBag.idhotel);
        formdata.append("code", "@ViewBag.code");
        formdata.append("cname", $("#cname").val());
        formdata.append("cemail", $("#cemail").val());
        formdata.append("cphone", $("#cphone").val());
        formdata.append("caddress", $("#caddress").val());
        formdata.append("paymenttype", $("#paymenttype").val());
        formdata.append("cnote", $("#cnote").val());
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/HotelBooking/updateBooking');
        xhr.send(formdata);        
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) { 
                if(xhr.responseText!="0"){
                    //alert("Xác nhận đặt phòng thành công! Chúng tôi sẽ liên hệ với khách hàng qua email và điện thoại sớm nhất!");
                    //if ($("#paymenttype").val()=="Chuyển khoản Ebanking"){
                        //window.location.href="/HotelBooking/Payment?idhotel=@ViewBag.idhotel&code=@ViewBag.code";
                    //}else{
                    chat.server.joinRoom("alertadmin", $("#cname").val()+", email: "+$("#cemail").val()+" vừa đặt phòng khách sạn @ViewBag.hotelname &nbsp;<a onclick='window.location=\"/HotelBooking/Index#@ViewBag.idhotel\";location.reload();' style=\"cursor:pointer;\">Xem tại đây</a>");
                        window.location.href="/HotelBooking/ConfirmEmail";
                    //}
                }else{
                    alert("Chương trình đang cập nhật, mời bạn quay lại sau!");
                }
            }
        }
    }
</script>
